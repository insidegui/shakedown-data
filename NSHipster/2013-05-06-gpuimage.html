<div class="announce instapaper_body md" data-path="2013-05-06-gpuimage.md" id="file"><article class="markdown-body entry-content" itemprop="text"><table data-table-type="yaml-metadata">
  <thead>
  <tr>
  <th>title</th>

  <th>author</th>

  <th>category</th>

  <th>excerpt</th>

  <th>status</th>
  </tr>
  </thead>
  <tbody>
  <tr>
  <td><div>GPUImage</div></td>

  <td><div>Mattt Thompson</div></td>

  <td><div>Open Source</div></td>

  <td><div>GPUImage is a BSD-licensed iOS library  that lets you apply GPU-accelerated filters and other effects to images, live camera video, and movies. If you're not careful, you may well end up creating a camera app by the end of the article.</div></td>

  <td><div><table>
  <thead>
  <tr>
  <th>swift</th>
  </tr>
  </thead>
  <tbody>
  <tr>
  <td><div>n/a</div></td>
  </tr>
  </tbody>
</table></div></td>
  </tr>
  </tbody>
</table>

<p>Here at NSHipster, we're all about diving into the darker corners of Objective-C to learn something new about the systems we interact with every day. Often, this means sifting through Apple frameworks or language features (it is, after all, a lot of what it means to work in Objective-C). However, <a href="http://nshipster.com/reactivecocoa/">on occasion</a>, it's nice to take a look to the burgeoning landscape of third-party libraries and frameworks (and there are some truly remarkable ones) for a glimpse of what's new and great outside of Cupertino.</p>

<p>This week, we'll be taking a look at one of the most impressive open source projects you'll find: <a href="https://github.com/BradLarson/GPUImage">GPUImage</a>. Buckle up, NSHipsters—if you're not careful, you may well end up creating a camera app by the end of the article.</p>

<hr>

<p>GPUImage is a BSD-licensed iOS library written by <a href="https://github.com/BradLarson/">Brad Larson</a> that lets you apply GPU-accelerated filters and other effects to images, live camera video, and movies.</p>

<h2><a id="user-content-gpu-vs-cpu" class="anchor" href="#gpu-vs-cpu" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>GPU vs. CPU</h2>

<p>Every iPhone ships with two processors: a <a href="http://en.wikipedia.org/wiki/Central_processing_unit">CPU</a>, or Central Processing Unit and a <a href="http://en.wikipedia.org/wiki/Graphics_processing_unit">GPU</a>, or Graphics Processing Unit. Each processor has its own strengths, and modern chip architecture (like in the iPhone's <a href="http://en.wikipedia.org/wiki/Apple_A4">A4</a>) integrate the CPU and GPU onto the same physical die.</p>

<p>When you write C or Objective-C code in Xcode, you're generating instructions that will be handled almost exclusively by the CPU. The GPU, by contrast, is a specialized chip that is especially well-suited for computation that can be split out into many small, independent operations, such as graphics rendering. The kinds of instructions understood by the GPU are quite different from that of the CPU, and as such, we write this code in a different language: <a href="http://en.wikipedia.org/wiki/Opengl">OpenGL</a> (or specifically, <a href="http://en.wikipedia.org/wiki/OpenGL_ES">OpenGL ES</a> on the iPhone &amp; iPad).</p>

<blockquote>
<p>Check out <a href="http://iphonedevelopment.blogspot.com/2010/11/opengl-es-20-for-ios-chapter-4.html">Jeff LaMarche's GLProgram OpenGL ES 2.0 book</a> for a great introduction to OpenGL ES and the rendering pipeline.</p>
</blockquote>

<p>Comparing the performance of GPU-based rendering to CPU rendering for something like video, the differences are staggering:</p>

<table id="user-content-gpuimage-benchmarks">
  CPU vs. GPU Frame-Rate (Larger FPS is Better)
  <thead>
    <tr>
      <th>Calculation</th>
      <th>GPU FPS</th>
      <th>CPU FPS</th>
      <th>Δ</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Thresholding ⨉ 1</td>
      <td>60.00</td>
      <td>4.21</td>
      <td>14.3⨉</td>
    </tr>
    <tr>
      <td>Thresholding ⨉ 2</td>
      <td>33.63</td>
      <td>2.36</td>
      <td>14.3⨉</td>
    </tr>
    <tr>
      <td>Thresholding ⨉ 100</td>
      <td>1.45</td>
      <td>0.05</td>
      <td>28.7⨉</td>
    </tr>
  </tbody>
</table>

<h3><a id="user-content-oh-so-its-like-instagram" class="anchor" href="#oh-so-its-like-instagram" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><em>Oh, so it's like Instagram?</em></h3>

<p>Let me put it this way:</p>

<blockquote>
<p>Instagram : GPUImage :: Disposable Camera : NASA Space Optics Manufacturing Center</p>
</blockquote>

<p>To put it another way, within GPUImage's APIs lay <em>thousands</em> of camera apps, just waiting for the right combination of filters and a little spark of imagination.</p>

<p>Here's a table of the 125 (!) filters that come with GPUImage:</p>

<table id="user-content-gpuimage-filters">
  <thead>
    <tr>
      <th>Color Adjustments</th>
      <th>Image Processing</th>
      <th>Blending Modes</th>
      <th>Visual Effects</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <ul>
          <li>Brightness Filter</li>
          <li>Exposure Filter</li>
          <li>Contrast Filter</li>
          <li>Saturation Filter</li>
          <li>Gamma Filter</li>
          <li>Levels Filter</li>
          <li>Color Matrix Filter</li>
          <li>RGB Filter</li>
          <li>Hue Filter</li>
          <li>Tone Curve Filter</li>
          <li>Highlight Shadow Filter</li>
          <li>Lookup Filter</li>
          <li>Amatorka Filter</li>
          <li>Miss Etikate Filter</li>
          <li>Soft Elegance Filter</li>
          <li>Color Invert Filter</li>
          <li>Grayscale Filter</li>
          <li>Monochrome Filter</li>
          <li>False Color Filter</li>
          <li>Haze Filter</li>
          <li>Sepia Filter</li>
          <li>Opacity Filter</li>
          <li>Solid Color Generator</li>
          <li>Luminance Threshold Filter</li>
          <li>Adaptive Threshold Filter</li>
          <li>Average Luminance Threshold Filter</li>
          <li>Histogram Filter</li>
          <li>Histogram Generator</li>
          <li>Average Color</li>
          <li>Luminosity</li>
          <li>Chroma Key Filter</li>
        </ul>
      </td>
      <td>
        <ul>
          <li>Transform Filter</li>
          <li>Crop Filter</li>
          <li>Lanczos Resampling Filter</li>
          <li>Sharpen Filter</li>
          <li>Unsharp Mask Filter</li>
          <li>Fast Blur Filter</li>
          <li>Single Component Fast Blur Filter</li>
          <li>Gaussian Blur Filter</li>
          <li>Single Component Gaussian Blur Filter</li>
          <li>Gaussian Selective Blur Filter</li>
          <li>Gaussian Blur Position Filter</li>
          <li>Median Filter</li>
          <li>Bilateral Filter</li>
          <li>Tilt Shift Filter</li>
          <li>Box Blur Filter</li>
          <li>3x3 Convolution Filter</li>
          <li>Sobel Edge Detection Filter</li>
          <li>Threshold Edge Detection Filter</li>
          <li>Canny Edge Detection Filter</li>
          <li>Harris Corner Detection Filter</li>
          <li>Noble Corner Detection Filter</li>
          <li>Shi-Tomasi Corner Detection Filter</li>
          <li>Non Maximum Suppression Filter</li>
          <li>X/Y Derivative Filter</li>
          <li>Crosshair Generator</li>
          <li>Dilation Filter</li>
          <li>RGB Dilation Filter</li>
          <li>Erosion Filter</li>
          <li>RGB Erosion Filter</li>
          <li>Opening Filter</li>
          <li>RGB Opening Filter</li>
          <li>Closing Filter</li>
          <li>RGB Closing Filter</li>
          <li>Local Binary Pattern Filter</li>
          <li>Low Pass Filter</li>
          <li>High Pass Filter</li>
          <li>Motion Detector</li>
          <li>Hough Transform Line Detector</li>
          <li>Line Generator</li>
          <li>Motion Blur Filter</li>
          <li>Zoom Blur Filter</li>
        </ul>
      </td>
      <td>
        <ul>
          <li>Chroma Key Blend Filter</li>
          <li>Dissolve Blend Filter</li>
          <li>Multiply Blend Filter</li>
          <li>Add Blend Filter</li>
          <li>Subtract Blend Filter</li>
          <li>Divide Blend Filter</li>
          <li>Overlay Blend Filter</li>
          <li>Darken Blend Filter</li>
          <li>Lighten Blend Filter</li>
          <li>Color Burn Blend Filter</li>
          <li>Color Dodge Blend Filter</li>
          <li>Screen Blend Filter</li>
          <li>Exclusion Blend Filter</li>
          <li>Difference Blend Filter</li>
          <li>Hard Light Blend Filter</li>
          <li>Soft Light Blend Filter</li>
          <li>Alpha Blend Filter</li>
          <li>Source Over Blend Filter</li>
          <li>Color Burn Blend Filter</li>
          <li>Color Dodge Blend Filter</li>
          <li>Normal Blend Filter</li>
          <li>Color Blend Filter</li>
          <li>Hue Blend Filter</li>
          <li>Saturation Blend Filter</li>
          <li>Luminosity Blend Filter</li>
          <li>Linear Burn Blend Filter</li>
          <li>Poisson Blend Filter</li>
          <li>Mask Filter</li>
        </ul>
      </td>
      <td>
        <ul>
          <li>Pixellate Filter</li>
          <li>Polar Pixellate Filter</li>
          <li>Polka Dot Filter</li>
          <li>Halftone Filter</li>
          <li>Crosshatch Filter</li>
          <li>Sketch Filter</li>
          <li>Threshold Sketch Filter</li>
          <li>Toon Filter</li>
          <li>Smooth Toon Filter</li>
          <li>Emboss Filter</li>
          <li>Posterize Filter</li>
          <li>Swirl Filter</li>
          <li>Bulge Distortion Filter</li>
          <li>Pinch Distortion Filter</li>
          <li>Stretch Distortion Filter</li>
          <li>Sphere Refraction Filter</li>
          <li>Glass Sphere Filter</li>
          <li>Vignette Filter</li>
          <li>Kuwahara Filter</li>
          <li>Kuwahara Radius 3 Filter</li>
          <li>Perlin Noise Filter</li>
          <li>CGAColorspace Filter</li>
          <li>Mosaic Filter</li>
          <li>JFAVoronoi Filter</li>
          <li>Voronoi Consumer Filter</li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p>Seriously, the <a href="https://github.com/BradLarson/GPUImage/tree/master/examples/iOS/FilterShowcase">Filter Showcase Example App</a> that comes bundled in the repository could easily retail on the AppStore for $3.99, as-is. Add Twitter integration and a few sound effects, and you could bump that up to a respectable $6.99.</p>

<h2><a id="user-content-rendering-pipeline" class="anchor" href="#rendering-pipeline" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Rendering Pipeline</h2>

<p><a href="{{ site.asseturl }}/gpuimage-pipeline.svg" target="_blank"><img src="{{ site.asseturl }}/gpuimage-pipeline.svg" style="max-width:100%;"></a></p>

<p>GPUImage is, at its core, an Objective-C abstraction around a rendering pipeline. Source images from the camera, network, or disk are loaded and manipulated according to a chain of filters, and finally outputted either a view, graphics context, or data stream.</p>

<p>For example, images from the video camera  could have a Color Levels filter applied to simulate different types of <a href="http://en.wikipedia.org/wiki/Color_blindness">color blindness</a> and displayed in a live view.</p>

<div class="highlight highlight-source-objc"><pre>GPUImageVideoCamera *videoCamera = [[GPUImageVideoCamera <span class="pl-c1">alloc</span>]
    <span class="pl-c1">initWithSessionPreset:</span>AVCaptureSessionPreset640x480
           <span class="pl-c1">cameraPosition:</span>AVCaptureDevicePositionBack];
videoCamera.outputImageOrientation = UIInterfaceOrientationPortrait;

GPUImageFilter *filter = [[GPUImageLevelsFilter <span class="pl-c1">alloc</span>] <span class="pl-c1">initWithFragmentShaderFromFile:</span><span class="pl-s"><span class="pl-pds">@"</span>CustomShader<span class="pl-pds">"</span></span>];
[filter <span class="pl-c1">setRedMin:</span><span class="pl-c1">0.299</span> <span class="pl-id">gamma</span>:<span class="pl-c1">1.0</span> <span class="pl-c1">max:</span><span class="pl-c1">1.0</span> <span class="pl-c1">minOut:</span><span class="pl-c1">0.0</span> <span class="pl-c1">maxOut:</span><span class="pl-c1">1.0</span>];
[filter <span class="pl-c1">setGreenMin:</span><span class="pl-c1">0.587</span> <span class="pl-id">gamma</span>:<span class="pl-c1">1.0</span> <span class="pl-c1">max:</span><span class="pl-c1">1.0</span> <span class="pl-c1">minOut:</span><span class="pl-c1">0.0</span> <span class="pl-c1">maxOut:</span><span class="pl-c1">1.0</span>];
[filter <span class="pl-c1">setBlueMin:</span><span class="pl-c1">0.114</span> <span class="pl-id">gamma</span>:<span class="pl-c1">1.0</span> <span class="pl-c1">max:</span><span class="pl-c1">1.0</span> <span class="pl-c1">minOut:</span><span class="pl-c1">0.0</span> <span class="pl-c1">maxOut:</span><span class="pl-c1">1.0</span>];
[videoCamera <span class="pl-c1">addTarget:</span>filter];

GPUImageView *filteredVideoView = [[GPUImageView <span class="pl-c1">alloc</span>] <span class="pl-c1">initWithFrame:</span><span class="pl-v">self</span>.view.bounds];
[filter <span class="pl-c1">addTarget:</span>filteredVideoView];
[<span class="pl-v">self</span>.view <span class="pl-c1">addSubview:</span>filteredVideoView];

[videoCamera <span class="pl-c1">startCameraCapture</span>];</pre></div>

<p>Or, combining various color blending modes, image effects, and adjustments, you could transform still images into something worthy of sharing with your hipster friends (example taken from <a href="https://github.com/eklipse2k8/FilterKit/blob/master/FilterKit/FilterKit/Filters/FKBlueValentine.m">FilterKit</a>, which is built on GPUImage):</p>

<div class="highlight highlight-source-objc"><pre>GPUImageFilterGroup *filter = [[GPUImageFilterGroup <span class="pl-c1">alloc</span>] <span class="pl-c1">init</span>];

GPUImageSaturationFilter *saturationFilter = [[GPUImageSaturationFilter <span class="pl-c1">alloc</span>] <span class="pl-c1">init</span>];
[saturationFilter <span class="pl-c1">setSaturation:</span><span class="pl-c1">0.5</span>];

GPUImageMonochromeFilter *monochromeFilter = [[GPUImageMonochromeFilter <span class="pl-c1">alloc</span>] <span class="pl-c1">init</span>];
[monochromeFilter <span class="pl-c1">setColor:</span>(GPUVector4){<span class="pl-c1">0</span>.<span class="pl-c1">0f</span>, <span class="pl-c1">0</span>.<span class="pl-c1">0f</span>, <span class="pl-c1">1</span>.<span class="pl-c1">0f</span>, <span class="pl-c1">1</span>.<span class="pl-c1">0f</span>}];
[monochromeFilter <span class="pl-c1">setIntensity:</span><span class="pl-c1">0.2</span>];

GPUImageVignetteFilter *vignetteFilter = [[GPUImageVignetteFilter <span class="pl-c1">alloc</span>] <span class="pl-c1">init</span>];
[vignetteFilter <span class="pl-c1">setVignetteEnd:</span><span class="pl-c1">0.7</span>];

GPUImageExposureFilter *exposureFilter = [[GPUImageExposureFilter <span class="pl-c1">alloc</span>] <span class="pl-c1">init</span>];
[exposureFilter <span class="pl-c1">setExposure:</span><span class="pl-c1">0.3</span>];

[filter <span class="pl-c1">addGPUFilter:</span>exposureFilter];
[filter <span class="pl-c1">addGPUFilter:</span>monochromeFilter];
[filter <span class="pl-c1">addGPUFilter:</span>saturationFilter];
[filter <span class="pl-c1">addGPUFilter:</span>vignetteFilter];</pre></div>

<hr>

<p>Looking through all of what GPUImage can do, one can't help but get <em>excited</em>. Easy enough to get started immediately (without needing to know anything about OpenGL) yet performant enough to power whatever you dream up. And not just that, but it also comes with a dizzying number of building blocks—all of the color adjustments, blending modes, and visual effects you could ever want (or never knew you needed).</p>

<p>GPUImage is a rare treat for the open source community, and we as Mac &amp; iOS developers are lucky to have it at our disposal. Use it to make something great, and show others the world in a whole new way.</p>
</article></div>