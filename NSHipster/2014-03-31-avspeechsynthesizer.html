<div class="announce instapaper_body md" data-path="2014-03-31-avspeechsynthesizer.md" id="file"><article class="markdown-body entry-content" itemprop="text"><table data-table-type="yaml-metadata">
  <thead>
  <tr>
  <th>title</th>

  <th>author</th>

  <th>category</th>

  <th>excerpt</th>

  <th>status</th>
  </tr>
  </thead>
  <tbody>
  <tr>
  <td><div>AVSpeechSynthesizer</div></td>

  <td><div>Mattt Thompson</div></td>

  <td><div>Cocoa</div></td>

  <td><div>Though we're a long way off from Hal or Her, we should never forget about the billions of other people out there for us to talk to.</div></td>

  <td><div><table>
  <thead>
  <tr>
  <th>swift</th>

  <th>reviewed</th>
  </tr>
  </thead>
  <tbody>
  <tr>
  <td><div>2.0</div></td>

  <td><div>September 10, 2015</div></td>
  </tr>
  </tbody>
</table></div></td>
  </tr>
  </tbody>
</table>

<p>Though we're a long way off from <a href="https://www.youtube.com/watch?v=ARJ8cAGm6JE"><em>Hal</em></a> or <a href="https://www.youtube.com/watch?v=WzV6mXIOVl4"><em>Her</em></a>, we should never forget about the billions of other people out there for us to talk to.</p>

<p>Of the thousands of languages in existence, an individual is fortunate to gain a command of just two within their lifetime. And yet, over several millennia of human co-existence, civilization has managed to make things work, more or less, through an ad-hoc network of interpreters, translators, scholars, and children raised in the mixed linguistic traditions of their parents. We've seen that mutual understanding fosters peace, and that conversely, mutual unintelligibility destabilizes human relations.</p>

<p>It is fitting that the development of computational linguistics should coincide with the emergence of the international community we have today. Working towards mutual understanding, intergovernmental organizations like the United Nations and European Union have produced a substantial corpora of <a href="http://en.wikipedia.org/wiki/Parallel_text">parallel texts</a>, which form the foundation of modern language translation technologies.</p>

<blockquote>
<p>Another related linguistic development is the <a href="http://en.wikipedia.org/wiki/Esperanto">Esperanto</a> language, created by L. L. Zamenhof in an effort to promote harmony between people of different countries.</p>
</blockquote>

<p>And while automatic text translation has reached an acceptable level for everyday communication, there is still a divide when we venture out into unfamiliar places. There is still much work to be done in order to augment our ability to communicate with one another in person.</p>

<hr>

<p>Introduced in iOS 7, <code>AVSpeechSynthesizer</code> produces synthesized speech from a given <code>AVSpeechUtterance</code>. Each utterance can adjust its rate of speech and pitch, and be configured to use any one of the available <code>AVSpeechSynthesisVoice</code>s:</p>

<div class="highlight highlight-source-swift"><pre><span class="pl-k">import</span> <span class="pl-c1">AVFoundation</span>

<span class="pl-k">let</span> string <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Hello, World!<span class="pl-pds">"</span></span>
<span class="pl-k">let</span> utterance <span class="pl-k">=</span> AVSpeechUtterance(string: string)
utterance<span class="pl-k">.</span>voice <span class="pl-k">=</span> AVSpeechSynthesisVoice(language: <span class="pl-s"><span class="pl-pds">"</span>en-US<span class="pl-pds">"</span></span>)

<span class="pl-k">let</span> synthesizer <span class="pl-k">=</span> AVSpeechSynthesizer()
synthesizer<span class="pl-k">.</span>speakUtterance(utterance)</pre></div>

<div class="highlight highlight-source-objc"><pre><span class="pl-c1">NSString</span> *string = <span class="pl-s"><span class="pl-pds">@"</span>Hello, World!<span class="pl-pds">"</span></span>;
AVSpeechUtterance *utterance = [[AVSpeechUtterance <span class="pl-c1">alloc</span>] <span class="pl-c1">initWithString:</span>string];
utterance.voice = [AVSpeechSynthesisVoice <span class="pl-c1">voiceWithLanguage:</span><span class="pl-s"><span class="pl-pds">@"</span>en-US<span class="pl-pds">"</span></span>];

AVSpeechSynthesizer *synthesizer = [[AVSpeechSynthesizer <span class="pl-c1">alloc</span>] <span class="pl-c1">init</span>];
[synthesizer <span class="pl-c1">speakUtterance:</span>utterance];</pre></div>

<p>When speaking, a synthesizer can either be paused immediately or on the next word boundary, which makes for a less jarring user experience.</p>

<div class="highlight highlight-source-swift"><pre>synthesizer<span class="pl-k">.</span>pauseSpeakingAtBoundary(<span class="pl-k">.</span><span class="pl-c1">Word</span>)</pre></div>

<div class="highlight highlight-source-objc"><pre>[synthesizer <span class="pl-c1">pauseSpeakingAtBoundary:</span>AVSpeechBoundaryWord];</pre></div>

<h2><a id="user-content-supported-languages" class="anchor" href="#supported-languages" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Supported Languages</h2>

<p>Mac OS 9 users will no doubt have fond memories of the old system voices: Bubbles, Cellos, Pipe Organ, and Bad News.</p>

<blockquote>
<p>These can still be installed on OS X. Just look under the "English (United States) - Novelty" voices in the "Dictation &amp; Speech" preference pane.</p>
</blockquote>

<p>In the name of quality over quantity, each language is provided a voice for each major locale region. So instead of asking for "Fred" and "Markus", <code>AVSpeechSynthesisVoice</code> asks for <code>en-US</code> and <code>de-DE</code>.</p>

<p>As of iOS 8.1, <code>[AVSpeechSynthesisVoice speechVoices]</code> the following languages and locales are supported:</p>

<ul>
<li>Arabic (<code>ar-SA</code>)</li>
<li>Chinese (<code>zh-CN</code>, <code>zh-HK</code>, <code>zh-TW</code>)</li>
<li>Czech (<code>cs-CZ</code>)</li>
<li>Danish (<code>da-DK</code>)</li>
<li>Dutch (<code>nl-BE</code>, <code>nl-NL</code>)</li>
<li>English (<code>en-AU</code>, <code>en-GB</code>, <code>en-IE</code>, <code>en-US</code>, <code>en-ZA</code>)</li>
<li>Finnish (<code>fi-FI</code>)</li>
<li>French (<code>fr-CA</code>, <code>fr-FR</code>)</li>
<li>German (<code>de-DE</code>)</li>
<li>Greek (<code>el-GR</code>)</li>
<li>Hebrew (<code>he-IL</code>)</li>
<li>Hindi (<code>hi-IN</code>)</li>
<li>Hungarian (<code>hu-HU</code>)</li>
<li>Indonesian (<code>id-ID</code>)</li>
<li>Italian (<code>it-IT</code>)</li>
<li>Japanese (<code>ja-JP</code>)</li>
<li>Korean (<code>ko-KR</code>)</li>
<li>Norwegian (<code>no-NO</code>)</li>
<li>Polish (<code>pl-PL</code>)</li>
<li>Portuguese (<code>pt-BR</code>, <code>pt-PT</code>)</li>
<li>Romanian (<code>ro-RO</code>)</li>
<li>Russian (<code>ru-RU</code>)</li>
<li>Slovak (<code>sk-SK</code>)</li>
<li>Spanish (<code>es-ES</code>, <code>es-MX</code>)</li>
<li>Swedish (<code>sv-SE</code>)</li>
<li>Thai (<code>th-TH</code>)</li>
<li>Turkish (<code>tr-TR</code>)</li>
</ul>

<p><code>NSLocale</code> and <code>NSLinguisticTagger</code> both use ISO 681 codes to identify languages. <code>AVSpeechSynthesisVoice</code>, however, takes an <a href="http://en.wikipedia.org/wiki/IETF_language_tag">IETF Language Tag</a>, as specified <a href="http://tools.ietf.org/html/bcp47">BCP 47 Document Series</a>. If an utterance string and voice aren't in the same language, speech synthesis will fail.</p>

<blockquote>
<p><a href="https://gist.github.com/mattt/9892187">This gist</a> shows how to detect an ISO 681 language code from an arbitrary string, and convert that to an IETF language tag.</p>
</blockquote>

<h2><a id="user-content-delegate-methods" class="anchor" href="#delegate-methods" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Delegate Methods</h2>

<p>What makes <code>AVSpeechSynthesizer</code> really amazing for developers is the ability to hook into speech events. An object conforming to <code>AVSpeechSynthesizerDelegate</code> can be called when its speech synthesizer either starts or finishes, pauses or continues, and as each range of the utterance is spoken.</p>

<p>For example, an app, in addition to synthesizing a voice utterance, could show that utterance in a label, and highlight the word currently being spoken:</p>

<div class="highlight highlight-source-swift"><pre><span class="pl-k">var</span> utteranceLabel: UILabel<span class="pl-k">!</span>

<span class="pl-c">// MARK: AVSpeechSynthesizerDelegate</span>

<span class="pl-k">func</span> <span class="pl-en">speechSynthesizer</span>(synthesizer: AVSpeechSynthesizer, <span class="pl-en">willSpeakRangeOfSpeechString</span> <span class="pl-smi">characterRange</span>: NSRange, utterance: AVSpeechUtterance) {
    <span class="pl-k">let</span> mutableAttributedString <span class="pl-k">=</span> NSMutableAttributedString(string: utterance<span class="pl-k">.</span>speechString)
    mutableAttributedString<span class="pl-k">.</span>addAttribute(NSForegroundColorAttributeName, value: UIColor<span class="pl-k">.</span>redColor(), range: characterRange)
    utteranceLabel<span class="pl-k">.</span>attributedText <span class="pl-k">=</span> mutableAttributedString
}

<span class="pl-k">func</span> <span class="pl-en">speechSynthesizer</span>(synthesizer: AVSpeechSynthesizer, <span class="pl-en">didFinishSpeechUtterance</span> <span class="pl-smi">utterance</span>: AVSpeechUtterance) {
    utteranceLabel<span class="pl-k">.</span>attributedText <span class="pl-k">=</span> NSAttributedString(string: utterance<span class="pl-k">.</span>speechString)
}</pre></div>

<div class="highlight highlight-source-objc"><pre>#<span class="pl-k">pragma mark</span> - AVSpeechSynthesizerDelegate

- (<span class="pl-k">void</span>)speechSynthesizer:(AVSpeechSynthesizer *)synthesizer
willSpeakRangeOfSpeechString:(<span class="pl-c1">NSRange</span>)characterRange
                utterance:(AVSpeechUtterance *)utterance
{
    <span class="pl-c1">NSMutableAttributedString</span> *mutableAttributedString = [[<span class="pl-c1">NSMutableAttributedString</span> <span class="pl-c1">alloc</span>] <span class="pl-c1">initWithString:</span>utterance.speechString];
    [mutableAttributedString <span class="pl-c1">addAttribute:</span><span class="pl-c1">NSForegroundColorAttributeName</span>
                                    <span class="pl-c1">value:</span>[UIColor <span class="pl-c1">redColor</span>] <span class="pl-c1">range:</span>characterRange];
    self.<span class="pl-smi">utteranceLabel</span>.<span class="pl-smi">attributedText</span> = mutableAttributedString;
}

- (<span class="pl-k">void</span>)speechSynthesizer:(AVSpeechSynthesizer *)synthesizer
 didFinishSpeechUtterance:(AVSpeechUtterance *)utterance
{
    self.<span class="pl-smi">utteranceLabel</span>.<span class="pl-smi">attributedText</span> = [[<span class="pl-c1">NSAttributedString</span> <span class="pl-c1">alloc</span>] <span class="pl-c1">initWithString:</span><span class="pl-v">self</span>.utteranceString];
}</pre></div>

<p><a href="%7B%7B%20site.asseturl%20%7D%7D/avspeechsynthesizer-example.gif" target="_blank"><img src="%7B%7B%20site.asseturl%20%7D%7D/avspeechsynthesizer-example.gif" alt="AVSpeechSynthesizer Example" style="max-width:100%;"></a></p>

<p>See <a href="https://github.com/mattt/AVSpeechSynthesizer-Example">this example app</a> for a demonstration of live text-highlighting for all of the supported languages.</p>

<hr>

<p>Anyone who travels to an unfamiliar place returns with a profound understanding of what it means to communicate. It's totally different from how one is taught a language in High School: instead of genders and cases, it's about emotions and patience and clinging onto every shred of understanding. One is astounded by the extent to which two humans can communicate with hand gestures and facial expressions. One is also humbled by how frustrating it can be when pantomiming breaks down.</p>

<p>In our modern age, we have the opportunity to go out in a world augmented by a collective computational infrastructure. Armed with <code>AVSpeechSynthesizer</code> and the myriad other linguistic technologies on iOS and elsewhere, we have never been more capable of breaking down the forces that most divide our species.</p>

<p>If that isn't universe-denting, then I don't know what is.</p>
</article></div>