<div class="announce instapaper_body md" data-path="2013-09-23-ios7.md" id="file"><article class="markdown-body entry-content" itemprop="text"><table data-table-type="yaml-metadata">
  <thead>
  <tr>
  <th>title</th>

  <th>author</th>

  <th>category</th>

  <th>excerpt</th>

  <th>status</th>
  </tr>
  </thead>
  <tbody>
  <tr>
  <td><div>iOS 7</div></td>

  <td><div>Mattt Thompson</div></td>

  <td><div></div></td>

  <td><div>With the NDA finally lifted, we can finally talk about all of the amazing new APIs in iOS 7.</div></td>

  <td><div><table>
  <thead>
  <tr>
  <th>swift</th>

  <th>reviewed</th>
  </tr>
  </thead>
  <tbody>
  <tr>
  <td><div>2.0</div></td>

  <td><div>Sep 12, 2015</div></td>
  </tr>
  </tbody>
</table></div></td>
  </tr>
  </tbody>
</table>

<p>With the NDA finally lifted, we can finally talk about all of the amazing new APIs in iOS 7. And there are a <em>lot</em> of them. "1500 new APIs", by Apple's count during the WWDC Keynote. (Granted, a good portion of that could just be all of the changes from <code>id</code> to <code>instancetype</code>, but that's a huge number, regardless).</p>

<p>We'll be going over many of the new features iOS 7 in depth over the coming weeks, but with all of the excitement around this major release, this week's issue will hit on some of the gems hiding in plain sight: <code>NSData</code> Base64 encoding, <code>NSURLComponents</code>, <code>NSProgress</code>, <code>CIDetectorSmile</code>, <code>CIDetectorEyeBlink</code>, <code>SSReadingList</code>, <code>AVCaptureMetaDataOutput</code>, <code>AVSpeechSynthesizer</code>, and <code>MKDistanceFormatter</code>.</p>

<hr>

<h2><a id="user-content-nsdata-nsdatabase64encoding" class="anchor" href="#nsdata-nsdatabase64encoding" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>NSData (NSDataBase64Encoding)</h2>

<p><a href="http://en.wikipedia.org/wiki/Base64">Base64</a> is a general term for encoding binary data as ASCII text. This is used all over the place on the web, since many core technologies are designed to support text, but not raw binary. For instance, CSS can embed images with <a href="http://en.wikipedia.org/wiki/Data_URI_scheme">inline <code>data://</code> URIs</a>, which are often Base64-encoded. Another example is <a href="http://en.wikipedia.org/wiki/Basic_access_authentication">Basic <code>Authentication</code> headers</a>, which Base64-encodes its username/password pair, which is marginally better than having them completely in the clear.</p>

<p>For the longest time, this boringly essential function was completely MIA, leaving thousands of developers to copy-paste random code snippets from forum threads. It was an omission as conspicuous and annoying as JSON pre-iOS 5.</p>

<p>But no longer! iOS 7 finally bakes-in Base64:</p>

<div class="highlight highlight-source-swift"><pre><span class="pl-k">let</span> string <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Lorem ipsum dolor sit amet.<span class="pl-pds">"</span></span>
<span class="pl-k">if</span> <span class="pl-k">let</span> data <span class="pl-k">=</span> string<span class="pl-k">.</span>dataUsingEncoding(NSUTF8StringEncoding) {
    <span class="pl-k">let</span> base64EncodedString <span class="pl-k">=</span> data<span class="pl-k">.</span>base64EncodedStringWithOptions([])

    <span class="pl-c1">print</span>(base64EncodedString)    <span class="pl-c">// TG9yZW0gaXBzdW0gZG9sYXIgc2l0IGFtZXQu</span>
}</pre></div>

<div class="highlight highlight-source-objc"><pre><span class="pl-c1">NSString</span> *string = <span class="pl-s"><span class="pl-pds">@"</span>Lorem ipsum dolor sit amet.<span class="pl-pds">"</span></span>;
<span class="pl-c1">NSString</span> *base64EncodedString = [[string <span class="pl-c1">dataUsingEncoding:</span>NSUTF8StringEncoding] <span class="pl-c1">base64EncodedStringWithOptions:</span><span class="pl-c1">0</span>];

<span class="pl-c1">NSLog</span>(<span class="pl-s"><span class="pl-pds">@"</span><span class="pl-c1">%@</span><span class="pl-pds">"</span></span>, base64EncodedString);  <span class="pl-c">// TG9yZW0gaXBzdW0gZG9sYXIgc2l0IGFtZXQu</span></pre></div>

<h2><a id="user-content-nsurlcomponents--nscharacterset-nsurlutilities" class="anchor" href="#nsurlcomponents--nscharacterset-nsurlutilities" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>NSURLComponents &amp; NSCharacterSet (NSURLUtilities)</h2>

<p>Foundation is blessed with a wealth of functionality for working with URIs. Unfortunately, many of the APIs for manipulating URLs are strewn across <code>NSString</code>, since <code>NSURL</code> is immutable.</p>

<p><code>NSURLComponents</code> dramatically improves this situation. Think of it as <code>NSMutableURL</code>:</p>

<div class="highlight highlight-source-swift"><pre><span class="pl-k">if</span> <span class="pl-k">let</span> components <span class="pl-k">=</span> NSURLComponents(string: <span class="pl-s"><span class="pl-pds">"</span>http://nshipster.com<span class="pl-pds">"</span></span>) {
    components<span class="pl-k">.</span>path <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>/iOS7<span class="pl-pds">"</span></span>
    components<span class="pl-k">.</span>query <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>foo=bar<span class="pl-pds">"</span></span>

    <span class="pl-c1">print</span>(components<span class="pl-k">.</span>scheme<span class="pl-k">!</span>)     <span class="pl-c">// http</span>
    <span class="pl-c1">print</span>(components<span class="pl-k">.</span>URL<span class="pl-k">!</span>)        <span class="pl-c">// http://nshipster.com/iOS7?foo=bar</span>
}</pre></div>

<div class="highlight highlight-source-objc"><pre><span class="pl-c1">NSURLComponents</span> *components = [<span class="pl-c1">NSURLComponents</span> <span class="pl-c1">componentsWithString:</span><span class="pl-s"><span class="pl-pds">@"</span>http://nshipster.com<span class="pl-pds">"</span></span>];
components.path = <span class="pl-s"><span class="pl-pds">@"</span>/iOS7<span class="pl-pds">"</span></span>;
components.query = <span class="pl-s"><span class="pl-pds">@"</span>foo=bar<span class="pl-pds">"</span></span>;

<span class="pl-c1">NSLog</span>(<span class="pl-s"><span class="pl-pds">@"</span><span class="pl-c1">%@</span><span class="pl-pds">"</span></span>, components.scheme);    <span class="pl-c">// http</span>
<span class="pl-c1">NSLog</span>(<span class="pl-s"><span class="pl-pds">@"</span><span class="pl-c1">%@</span><span class="pl-pds">"</span></span>, [components <span class="pl-c1">URL</span>]);     <span class="pl-c">// http://nshipster.com/iOS7?foo=bar</span></pre></div>

<p>Each property for URL components also has a <code>percentEncoded*</code> variation (e.g. <code>user</code> &amp; <code>percentEncodedUser</code>), which forgoes any additional URI percent encoding of special characters.</p>

<p>Which characters are special, you ask? Well, it depends on what part of the URL you're talking about. Good thing that <code>NSCharacterSet</code> adds a new category for allowed URL characters in iOS 7:</p>

<ul>
<li><code>+ (id)URLUserAllowedCharacterSet</code></li>
<li><code>+ (id)URLPasswordAllowedCharacterSet</code></li>
<li><code>+ (id)URLHostAllowedCharacterSet</code></li>
<li><code>+ (id)URLPathAllowedCharacterSet</code></li>
<li><code>+ (id)URLQueryAllowedCharacterSet</code></li>
<li><code>+ (id)URLFragmentAllowedCharacterSet</code></li>
</ul>

<h2><a id="user-content-nsprogress" class="anchor" href="#nsprogress" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>NSProgress</h2>

<p><code>NSProgress</code> is a tough class to describe. It acts as both an observer and a delegate / coordinator, acting as a handle for reporting and monitoring progress. It integrates with system-level processes on OS X, but can also be plugged into user-facing UI. It can specify handlers for pausing and canceling, which then forward onto the operation actually doing the work.</p>

<p>Anything with a notion of completed and total units is a candidate for <code>NSProgress</code>, whether it's the bytes written to a file, the number of frames in a large render job, or the files downloaded from a server.</p>

<p><code>NSProgress</code> can be used to simply report overall progress in a localized way:</p>

<div class="highlight highlight-source-swift"><pre><span class="pl-k">let</span> progress <span class="pl-k">=</span> NSProgress(totalUnitCount: <span class="pl-c1">100</span>)
progress<span class="pl-k">.</span>completedUnitCount <span class="pl-k">=</span> <span class="pl-c1">42</span>;

<span class="pl-c1">print</span>(progress<span class="pl-k">.</span>localizedDescription) <span class="pl-c">// 42% completed</span></pre></div>

<div class="highlight highlight-source-objc"><pre><span class="pl-c1">NSProgress</span> *progress = [<span class="pl-c1">NSProgress</span> <span class="pl-c1">progressWithTotalUnitCount:</span><span class="pl-c1">100</span>];
progress.completedUnitCount = <span class="pl-c1">42</span>;

<span class="pl-c1">NSLog</span>(<span class="pl-s"><span class="pl-pds">@"</span><span class="pl-c1">%@</span><span class="pl-pds">"</span></span>, [progress <span class="pl-c1">localizedDescription</span>]); <span class="pl-c">// 42% completed</span></pre></div>

<p>...or it can be given a handler for stopping work entirely:</p>

<div class="highlight highlight-source-swift"><pre><span class="pl-k">let</span> timer <span class="pl-k">=</span> NSTimer(timeInterval: <span class="pl-c1">1</span><span class="pl-k">.</span><span class="pl-c1">0</span>, target: <span class="pl-k">self</span>, selector: <span class="pl-s"><span class="pl-pds">"</span>incrementCompletedUnitCount:<span class="pl-pds">"</span></span>,
    userInfo: <span class="pl-c1">nil</span>, repeats: <span class="pl-c1">true</span>)

progress<span class="pl-k">.</span>cancellationHandler <span class="pl-k">=</span> {
    timer<span class="pl-k">.</span>invalidate()
}

progress<span class="pl-k">.</span>cancel()</pre></div>

<div class="highlight highlight-source-objc"><pre><span class="pl-c1">NSTimer</span> *timer = [<span class="pl-c1">NSTimer</span> <span class="pl-c1">timerWithTimeInterval:</span><span class="pl-c1">1.0</span>
                                         <span class="pl-c1">target:</span><span class="pl-v">self</span>
                                       <span class="pl-c1">selector:</span><span class="pl-k">@selector</span>(<span class="pl-c1">incrementCompletedUnitCount:</span>) <span class="pl-c1">userInfo:</span><span class="pl-c1">nil</span>
                                        <span class="pl-c1">repeats:</span><span class="pl-c1">YES</span>];

progress.cancellationHandler = ^{
    [timer <span class="pl-c1">invalidate</span>];
};

[progress <span class="pl-c1">cancel</span>];</pre></div>

<p><code>NSProgress</code> makes a lot more sense in the context of OS X Mavericks, but for now, it remains a useful class for encapsulating the shared patterns of work units.</p>

<h2><a id="user-content-nsarray--firstobject" class="anchor" href="#nsarray--firstobject" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>NSArray -firstObject</h2>

<p>Rejoice! The <code>NSRangeException</code>-dodging convenience of <code>-lastObject</code> has finally been extended to the first member of an <code>NSArray</code>. (Well, it <em>has</em> been there as a private API since ~iOS 4, but that's water under the bridge now).</p>

<p>Behold!</p>

<div class="highlight highlight-source-swift"><pre><span class="pl-k">let</span> array <span class="pl-k">=</span> [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>] <span class="pl-k">as</span> NSArray

<span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">"</span>First Object: <span class="pl-pse">\(</span><span class="pl-s1">array<span class="pl-k">.</span>firstObject</span><span class="pl-pse">)</span><span class="pl-pds">"</span></span>)   <span class="pl-c">// First Object: Optional(1)</span>
<span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">"</span>Last Object: <span class="pl-pse">\(</span><span class="pl-s1">array<span class="pl-k">.</span>lastObject</span><span class="pl-pse">)</span><span class="pl-pds">"</span></span>)     <span class="pl-c">// Last Object: Optional(3)</span></pre></div>

<div class="highlight highlight-source-objc"><pre><span class="pl-c1">NSArray</span> *array = @[@<span class="pl-c1">1</span>, @<span class="pl-c1">2</span>, @<span class="pl-c1">3</span>];

<span class="pl-c1">NSLog</span>(<span class="pl-s"><span class="pl-pds">@"</span>First Object: <span class="pl-c1">%@</span><span class="pl-pds">"</span></span>, [array <span class="pl-c1">firstObject</span>]); <span class="pl-c">// First Object: 1</span>
<span class="pl-c1">NSLog</span>(<span class="pl-s"><span class="pl-pds">@"</span>Last Object: <span class="pl-c1">%@</span><span class="pl-pds">"</span></span>, [array <span class="pl-c1">lastObject</span>]);   <span class="pl-c">// Last Object: 3</span></pre></div>

<p>Refreshing!</p>

<h2><a id="user-content-cidetectorsmile--cidetectoreyeblink" class="anchor" href="#cidetectorsmile--cidetectoreyeblink" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CIDetectorSmile &amp; CIDetectorEyeBlink</h2>

<blockquote>
<p>As a random aside, shouldn't it be a cause for concern that the device most capable of taking embarrassing photos of ourselves is also the device most capable of distributing it to millions or people? Just a thought.</p>
</blockquote>

<p>Since iOS 5, the Core Image framework has provided facial detection and recognition functionality through the <code>CIDetector</code> class. If it wasn't insaneballs enough that we could detect faces in photos, in iOS 7 we can even tell if that face is smiling or has its eyes closed. *shudder*</p>

<p>In yet another free app idea, here's a snippet that might be used by a camera that only saves pictures of smiling faces:</p>

<div class="highlight highlight-source-swift"><pre><span class="pl-k">import</span> <span class="pl-c1">CoreImage</span>

<span class="pl-k">let</span> smileDetector <span class="pl-k">=</span> CIDetector(ofType: CIDetectorTypeFace, context: context,
    options: [CIDetectorTracking: <span class="pl-c1">true</span>, CIDetectorAccuracy: CIDetectorAccuracyLow])

<span class="pl-k">var</span> features <span class="pl-k">=</span> smileDetector<span class="pl-k">.</span>featuresInImage(ciImage, options: [CIDetectorSmile: <span class="pl-c1">true</span>])

<span class="pl-k">if</span> <span class="pl-k">let</span> feature <span class="pl-k">=</span> features<span class="pl-k">.</span><span class="pl-c1">first</span> <span class="pl-k">as?</span> CIFaceFeature <span class="pl-k">where</span> feature<span class="pl-k">.</span>hasSmile {
    UIImageWriteToSavedPhotosAlbum(UIImage(CIImage: ciImage), <span class="pl-k">self</span>, <span class="pl-s"><span class="pl-pds">"</span>didFinishWritingImage<span class="pl-pds">"</span></span>, <span class="pl-k">&amp;</span>features)
} <span class="pl-k">else</span> {
    label<span class="pl-k">.</span>text <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Say Cheese!<span class="pl-pds">"</span></span>
}</pre></div>

<div class="highlight highlight-source-objc"><pre>@import CoreImage;

CIDetector *smileDetector = [CIDetector <span class="pl-c1">detectorOfType:</span>CIDetectorTypeFace
                                <span class="pl-c1">context:</span>context
                                <span class="pl-c1">options:</span>@{CIDetectorTracking: @<span class="pl-c1">YES</span>,
                                          CIDetectorAccuracy: CIDetectorAccuracyLow}];
<span class="pl-c1">NSArray</span> *features = [smileDetector <span class="pl-c1">featuresInImage:</span>ciImage <span class="pl-c1">options:</span>@{CIDetectorSmile:@<span class="pl-c1">YES</span>}];
<span class="pl-k">if</span> (([features <span class="pl-c1">count</span>] &gt; <span class="pl-c1">0</span>) &amp;&amp; (((CIFaceFeature *)features[<span class="pl-c1">0</span>]).hasSmile)) {
    <span class="pl-c1">UIImageWriteToSavedPhotosAlbum</span>([UIImage <span class="pl-c1">imageWithCIImage:</span>ciImage], self, <span class="pl-k">@selector</span>(<span class="pl-c1">didFinishWritingImage</span>), features);
} <span class="pl-k">else</span> {
    self.<span class="pl-smi">label</span>.<span class="pl-smi">text</span> = <span class="pl-s"><span class="pl-pds">@"</span>Say Cheese!<span class="pl-pds">"</span></span>
}</pre></div>

<h2><a id="user-content-avcapturemetadataoutput" class="anchor" href="#avcapturemetadataoutput" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AVCaptureMetaDataOutput</h2>

<p>Scan UPCs, QR codes, and barcodes of all varieties with <code>AVCaptureMetaDataOutput</code>, new to iOS 7. All you need to do is set it up as the output of an <code>AVCaptureSession</code>, and implement the <code>captureOutput:didOutputMetadataObjects:fromConnection:</code> method accordingly:</p>

<div class="highlight highlight-source-swift"><pre><span class="pl-k">import</span> <span class="pl-c1">AVFoundation</span>

<span class="pl-k">let</span> session <span class="pl-k">=</span> AVCaptureSession()
<span class="pl-k">let</span> device <span class="pl-k">=</span> AVCaptureDevice<span class="pl-k">.</span>defaultDeviceWithMediaType(AVMediaTypeVideo)
<span class="pl-k">var</span> error: NSError?

<span class="pl-k">do</span> {
    <span class="pl-k">let</span> input <span class="pl-k">=</span> <span class="pl-k">try</span> AVCaptureDeviceInput(device: device)
    session<span class="pl-k">.</span>addInput(input)
} <span class="pl-k">catch</span> <span class="pl-k">let</span> error {
    <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">"</span>Error: <span class="pl-pse">\(</span><span class="pl-s1">error</span><span class="pl-pse">)</span><span class="pl-pds">"</span></span>)
}

<span class="pl-k">let</span> output <span class="pl-k">=</span> AVCaptureMetadataOutput()
output<span class="pl-k">.</span>setMetadataObjectsDelegate(<span class="pl-k">self</span>, queue: dispatch_get_main_queue())
session<span class="pl-k">.</span>addOutput(output)
output<span class="pl-k">.</span>metadataObjectTypes <span class="pl-k">=</span> [AVMetadataObjectTypeQRCode]

session<span class="pl-k">.</span>startRunning()

<span class="pl-c">// MARK: - AVCaptureMetadataOutputObjectsDelegate</span>

<span class="pl-k">func</span> <span class="pl-en">captureOutput</span>(
    captureOutput: AVCaptureOutput<span class="pl-k">!</span>,
    <span class="pl-en">didOutputMetadataObjects</span> <span class="pl-smi">metadataObjects</span>: [<span class="pl-c1">AnyObject</span>]<span class="pl-k">!</span>,
    <span class="pl-en">fromConnection</span> <span class="pl-smi">connection</span>: AVCaptureConnection<span class="pl-k">!</span>) {

        <span class="pl-k">var</span> QRCode: <span class="pl-c1">String</span>?
        <span class="pl-k">for</span> metadata <span class="pl-k">in</span> metadataObjects <span class="pl-k">as!</span> [AVMetadataObject] {
            <span class="pl-k">if</span> metadata<span class="pl-k">.</span>type <span class="pl-k">==</span> AVMetadataObjectTypeQRCode {
                <span class="pl-c">// This will never happen; nobody has ever scanned a QR code... ever</span>
                QRCode <span class="pl-k">=</span> (metadata <span class="pl-k">as!</span> AVMetadataMachineReadableCodeObject)<span class="pl-k">.</span><span class="pl-c1">stringValue</span>
            }
        }

        <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">"</span>QRCode: <span class="pl-pse">\(</span><span class="pl-s1">QRCode</span><span class="pl-pse">)</span><span class="pl-pds">"</span></span>)
}</pre></div>

<div class="highlight highlight-source-objc"><pre>@import AVFoundation;

AVCaptureSession *session = [[AVCaptureSession <span class="pl-c1">alloc</span>] <span class="pl-c1">init</span>];
AVCaptureDevice *device = [AVCaptureDevice <span class="pl-c1">defaultDeviceWithMediaType:</span>AVMediaTypeVideo];
<span class="pl-c1">NSError</span> *error = <span class="pl-c1">nil</span>;

AVCaptureDeviceInput *input = [AVCaptureDeviceInput <span class="pl-c1">deviceInputWithDevice:</span>device
                                                                    <span class="pl-c1">error:</span>&amp;error];
<span class="pl-k">if</span> (input) {
    [session <span class="pl-c1">addInput:</span>input];
} <span class="pl-k">else</span> {
    <span class="pl-c1">NSLog</span>(<span class="pl-s"><span class="pl-pds">@"</span>Error: <span class="pl-c1">%@</span><span class="pl-pds">"</span></span>, error);
}

AVCaptureMetadataOutput *output = [[AVCaptureMetadataOutput <span class="pl-c1">alloc</span>] <span class="pl-c1">init</span>];
[output <span class="pl-c1">setMetadataObjectsDelegate:</span><span class="pl-v">self</span> <span class="pl-c1">queue:</span><span class="pl-c1">dispatch_get_main_queue</span>()];
[session <span class="pl-c1">addOutput:</span>output];
[output <span class="pl-c1">setMetadataObjectTypes:</span>@[AVMetadataObjectTypeQRCode]];

[session <span class="pl-c1">startRunning</span>];

#<span class="pl-k">pragma mark</span> - AVCaptureMetadataOutputObjectsDelegate

- (<span class="pl-k">void</span>)captureOutput:(AVCaptureOutput *)captureOutput
didOutputMetadataObjects:(<span class="pl-c1">NSArray</span> *)metadataObjects
       fromConnection:(AVCaptureConnection *)connection
{
    <span class="pl-c1">NSString</span> *QRCode = <span class="pl-c1">nil</span>;
    <span class="pl-k">for</span> (AVMetadataObject *metadata in metadataObjects) {
        <span class="pl-k">if</span> ([metadata.type <span class="pl-c1">isEqualToString:</span>AVMetadataObjectTypeQRCode]) {
            <span class="pl-c">// This will never happen; nobody has ever scanned a QR code... ever</span>
            QRCode = [(AVMetadataMachineReadableCodeObject *)metadata <span class="pl-c1">stringValue</span>];
            <span class="pl-k">break</span>;
        }
    }

    <span class="pl-c1">NSLog</span>(<span class="pl-s"><span class="pl-pds">@"</span>QR Code: <span class="pl-c1">%@</span><span class="pl-pds">"</span></span>, QRCode);
}</pre></div>

<p><code>AVFoundation</code> supports every code you've heard of (and probably a few that you haven't):</p>

<ul>
<li><code>AVMetadataObjectTypeUPCECode</code></li>
<li><code>AVMetadataObjectTypeCode39Code</code></li>
<li><code>AVMetadataObjectTypeCode39Mod43Code</code></li>
<li><code>AVMetadataObjectTypeEAN13Code</code></li>
<li><code>AVMetadataObjectTypeEAN8Code</code></li>
<li><code>AVMetadataObjectTypeCode93Code</code></li>
<li><code>AVMetadataObjectTypeCode128Code</code></li>
<li><code>AVMetadataObjectTypePDF417Code</code></li>
<li><code>AVMetadataObjectTypeQRCode</code></li>
<li><code>AVMetadataObjectTypeAztecCode</code></li>
</ul>

<p>If nothing else, <code>AVCaptureMetaDataOutput</code> makes it possible to easily create a Passbook pass reader for the iPhone and iPad. There's still a lot of unrealized potential in Passbook, so here's to hoping that this API will be a factor in more widespread adoption.</p>

<h2><a id="user-content-ssreadinglist" class="anchor" href="#ssreadinglist" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SSReadingList</h2>

<p>Even though the number of people who have actually read something saved for later is only marginally greater than <a href="http://picturesofpeoplescanningqrcodes.tumblr.com">the number of people who have ever used a QR code</a>, it's nice that iOS 7 adds a way to add items to the Safari reading list with the new Safari Services framework.</p>

<div class="highlight highlight-source-swift"><pre><span class="pl-k">import</span> <span class="pl-c1">SafariServices</span>

<span class="pl-k">let</span> url <span class="pl-k">=</span> NSURL(string: <span class="pl-s"><span class="pl-pds">"</span>http://nshipster.com/ios7<span class="pl-pds">"</span></span>)<span class="pl-k">!</span>
<span class="pl-k">try</span>? SSReadingList<span class="pl-k">.</span>defaultReadingList()?<span class="pl-k">.</span>addReadingListItemWithURL(url, title: <span class="pl-s"><span class="pl-pds">"</span>NSHipster<span class="pl-pds">"</span></span>, previewText: <span class="pl-s"><span class="pl-pds">"</span>...<span class="pl-pds">"</span></span>)</pre></div>

<div class="highlight highlight-source-objc"><pre>@import SafariServices;

<span class="pl-c1">NSURL</span> *URL = [<span class="pl-c1">NSURL</span> <span class="pl-c1">URLWithString:</span><span class="pl-s"><span class="pl-pds">@"</span>http://nshipster.com/ios7<span class="pl-pds">"</span></span>];
[[SSReadingList <span class="pl-c1">defaultReadingList</span>] <span class="pl-c1">addReadingListItemWithURL:</span>URL
                                                        <span class="pl-c1">title:</span><span class="pl-s"><span class="pl-pds">@"</span>NSHipster<span class="pl-pds">"</span></span>
                                                  <span class="pl-c1">previewText:</span><span class="pl-s"><span class="pl-pds">@"</span>...<span class="pl-pds">"</span></span>
                                                        <span class="pl-c1">error:</span><span class="pl-c1">nil</span>];</pre></div>

<h2><a id="user-content-avspeechsynthesizer" class="anchor" href="#avspeechsynthesizer" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AVSpeechSynthesizer</h2>

<p>Text-to-Speech has been the killer feature of computers for <a href="http://nshipster.com/uiaccessibility/">accessibility</a> and <a href="http://nshipster.com/icloud/">pranking</a> enthusiasts since its inception in the late 1960s.</p>

<p>iOS 7 brings the power of Siri with the convenience of a <a href="http://en.wikipedia.org/wiki/Speak_%26_Spell_%28toy%29">Speak &amp; Spell</a> in a new class <code>AVSpeechSynthesizer</code>:</p>

<div class="highlight highlight-source-swift"><pre><span class="pl-k">import</span> <span class="pl-c1">AVFoundation</span>

<span class="pl-k">let</span> synthesizer <span class="pl-k">=</span> AVSpeechSynthesizer()
<span class="pl-k">let</span> utterance <span class="pl-k">=</span> AVSpeechUtterance(string: <span class="pl-s"><span class="pl-pds">"</span>Just what do you think you're doing, Dave?<span class="pl-pds">"</span></span>)
utterance<span class="pl-k">.</span>rate <span class="pl-k">=</span> AVSpeechUtteranceMinimumSpeechRate   <span class="pl-c">// Tell it to me slowly</span>
synthesizer<span class="pl-k">.</span>speakUtterance(utterance)</pre></div>

<div class="highlight highlight-source-objc"><pre>@import AVFoundation;

AVSpeechSynthesizer *synthesizer = [[AVSpeechSynthesizer <span class="pl-c1">alloc</span>] <span class="pl-c1">init</span>];
AVSpeechUtterance *utterance = [AVSpeechUtterance <span class="pl-c1">speechUtteranceWithString:</span><span class="pl-s"><span class="pl-pds">@"</span>Just what do you think you're doing, Dave?<span class="pl-pds">"</span></span>];
utterance.rate = AVSpeechUtteranceMinimumSpeechRate;  <span class="pl-c">// Tell it to me slowly</span>
[synthesizer <span class="pl-c1">speakUtterance:</span>utterance];</pre></div>

<h2><a id="user-content-mkdistanceformatter" class="anchor" href="#mkdistanceformatter" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MKDistanceFormatter</h2>

<p>Finally, we end our showcase of iOS 7's new and noteworthy APIs with another class that has NSHipsters crying out "finally!": <code>MKDistanceFormatter</code>.</p>

<p>As advertised, <code>MKDistanceFormatter</code> provides a way to convert distances into localized strings using either imperial or metric units:</p>

<div class="highlight highlight-source-swift"><pre><span class="pl-k">import</span> <span class="pl-c1">CoreLocation</span>
<span class="pl-k">import</span> <span class="pl-c1">MapKit</span>

<span class="pl-k">let</span> sanFrancisco <span class="pl-k">=</span> CLLocation(latitude: <span class="pl-c1">37</span><span class="pl-k">.</span><span class="pl-c1">775</span>, longitude: <span class="pl-c1">-122</span><span class="pl-k">.</span><span class="pl-c1">4183333</span>)
<span class="pl-k">let</span> portland <span class="pl-k">=</span> CLLocation(latitude: <span class="pl-c1">45</span><span class="pl-k">.</span><span class="pl-c1">5236111</span>, longitude: <span class="pl-c1">-122</span><span class="pl-k">.</span><span class="pl-c1">675</span>)
<span class="pl-k">let</span> <span class="pl-c1">distance</span> <span class="pl-k">=</span> portland<span class="pl-k">.</span>distanceFromLocation(sanFrancisco)

<span class="pl-k">let</span> formatter <span class="pl-k">=</span> MKDistanceFormatter()
formatter<span class="pl-k">.</span>units <span class="pl-k">=</span> <span class="pl-k">.</span>Imperial
<span class="pl-c1">print</span>(formatter<span class="pl-k">.</span>stringFromDistance(<span class="pl-c1">distance</span>)) <span class="pl-c">// 535 miles</span></pre></div>

<div class="highlight highlight-source-objc"><pre>@import CoreLocation;
@import MapKit;

CLLocation *sanFrancisco = [[CLLocation <span class="pl-c1">alloc</span>] <span class="pl-c1">initWithLatitude:</span><span class="pl-c1">37.775</span> <span class="pl-c1">longitude:</span>-<span class="pl-c1">122.4183333</span>];
CLLocation *portland = [[CLLocation <span class="pl-c1">alloc</span>] <span class="pl-c1">initWithLatitude:</span><span class="pl-c1">45.5236111</span> <span class="pl-c1">longitude:</span>-<span class="pl-c1">122.675</span>];
CLLocationDistance distance = [portland <span class="pl-c1">distanceFromLocation:</span>sanFrancisco];

MKDistanceFormatter *formatter = [[MKDistanceFormatter <span class="pl-c1">alloc</span>] <span class="pl-c1">init</span>];
formatter.units = MKDistanceFormatterUnitsImperial;
<span class="pl-c1">NSLog</span>(<span class="pl-s"><span class="pl-pds">@"</span><span class="pl-c1">%@</span><span class="pl-pds">"</span></span>, [formatter <span class="pl-c1">stringFromDistance:</span>distance]); <span class="pl-c">// 535 miles</span></pre></div>

<hr>

<p>So there you have it! This was just a small sample of the great new features of iOS 7. Still craving more? Check out Apple's <a href="https://developer.apple.com/library/ios/releasenotes/General/WhatsNewIniOS/Articles/iOS7.html">"What's New in iOS 7"</a> guide on the Developer Center.</p>
</article></div>