<div class="announce instapaper_body md" data-path="2013-05-27-unit-testing.md" id="file"><article class="markdown-body entry-content" itemprop="text"><table data-table-type="yaml-metadata">
  <thead>
  <tr>
  <th>title</th>

  <th>author</th>

  <th>category</th>

  <th>excerpt</th>

  <th>status</th>
  </tr>
  </thead>
  <tbody>
  <tr>
  <td><div>Unit Testing</div></td>

  <td><div>Mattt Thompson</div></td>

  <td><div>Objective-C</div></td>

  <td><div>Unit Testing is an emotional topic for developers. It inspires a sense of superiority to its most zealous adherents, and evokes a feeling of inadequacy to non-practitioners. Cargo Cults like TDD stake their reputation on unit testing to the point of co-opting and conflating utility with morality.</div></td>

  <td><div><table>
  <thead>
  <tr>
  <th>swift</th>
  </tr>
  </thead>
  <tbody>
  <tr>
  <td><div>n/a</div></td>
  </tr>
  </tbody>
</table></div></td>
  </tr>
  </tbody>
</table>

<p>Unit Testing is an emotional topic for developers. It inspires a sense of superiority to its most zealous adherents, and evokes a feeling of inadequacy to non-practitioners. <a href="http://ntoll.org/article/tdd-cargo-cult">Cargo Cults like TDD</a> stake their reputation on unit testing to the point of co-opting and conflating utility with morality.</p>

<p>It's as close to a religious matter as programmers get, aside from the tabs-versus-spaces debate.</p>

<p>Objective-C developers have, for the most part, remained relatively apathetic to Unit Testing (<em>"There's that SenTest thing, but who uses that, really?"</em>). Between static typing, typically manageable project sizes, and a compiler advanced enough to <a href="http://clang.llvm.org/doxygen/Rewriter_8h_source.html">rewrite code for you</a>, unit testing isn't as much of a necessity as it is for more dynamic languages like Ruby (at least in practice).</p>

<p>But that's not to say that Objective-C developers wouldn't benefit from unit testing. In fact, as Objective-C continues to become more collaborative, with growing participation in the open source community, automated testing will become a necessity.</p>

<p>This week NSHipster will explore the world of unit testing frameworks, and how to set up an automated build system with Travis CI.</p>

<hr>

<p><a href="https://en.wikipedia.org/wiki/Unit_testing">Unit Testing</a> is a tool, just like any other tool. Its purpose is to make us better at our jobs, which is to produce robust, maintainable software.</p>

<p>It's a simple enough premise: write code to construct environments that exercise the particular behavior of a given method, function, class, or feature. Variables are isolated in a scientific manner, so as to test assumptions with logical atomicity.</p>

<h2><a id="user-content-ocunit" class="anchor" href="#ocunit" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>OCUnit</h2>

<p><a href="http://www.sente.ch/software/ocunit/">OCUnit</a>, a.k.a. SenTestingKit, was integrated into Xcode 2.1 circa WWDC 2005, <a href="http://www.friday.com/bbum/2005/09/24/unit-testing">as a result of its use in the development of Core Data 1.0</a>. Developed by <a href="http://www.sente.ch">Sen:te</a>, OCUnit is actually one of the first unit testing libraries written for any language.</p>

<p>Unit Tests were added into a separate testing target in the Xcode Project. Each test file defines an <code>SenTestCase</code> subclass, which implements a series of methods beginning with the word <code>test</code>. C <code>assert</code>-style macros are used to fail tests if the specified condition is not met. Each test is run in sequence, independently of one another, with the results logged afterwards:</p>

<div class="highlight highlight-source-objc"><pre>#<span class="pl-k">import</span> <span class="pl-s"><span class="pl-pds">&lt;</span>SenTestingKit/SenTestingKit.h<span class="pl-pds">&gt;</span></span>
#<span class="pl-k">import</span> <span class="pl-s"><span class="pl-pds">"</span>Person.h<span class="pl-pds">"</span></span>

<span class="pl-k">@interface</span> <span class="pl-en">TestPerson</span> : <span class="pl-e">SenTestCase</span>
<span class="pl-k">@end</span>

<span class="pl-k">@implementation</span> <span class="pl-en">TestPerson</span>
- (<span class="pl-k">void</span>)<span class="pl-en">testFullName</span> {
   Person *person = [[Person <span class="pl-c1">alloc</span>] <span class="pl-c1">init</span>];
   person.<span class="pl-smi">firstName</span> = <span class="pl-s"><span class="pl-pds">@"</span>Pablo<span class="pl-pds">"</span></span>;
   person.<span class="pl-smi">lastName</span> = <span class="pl-s"><span class="pl-pds">@"</span>Picasso<span class="pl-pds">"</span></span>;
   <span class="pl-c1">STAssertEqualObjects</span>([person <span class="pl-c1">fullName</span>], <span class="pl-s"><span class="pl-pds">@"</span>Pablo Picasso<span class="pl-pds">"</span></span>, <span class="pl-c1">nil</span>);
}</pre></div>

<p>The SenTestingKit assertions are about what you'd expect, offering bread-and-butter equality, existence, and truth checks:</p>

<ul>
<li><code>STAssertNil()</code></li>
<li><code>STAssertNotNil()</code></li>
<li><code>STAssertTrue()</code></li>
<li><code>STAssertFalse()</code></li>
<li><code>STAssertEqualObjects()</code></li>
<li><code>STAssertEquals()</code></li>
<li><code>STAssertEqualsWithAccuracy()</code></li>
<li><code>STAssertThrows()</code></li>
<li><code>STAssertThrowsSpecific()</code></li>
<li><code>STAssertThrowsSpecificNamed()</code></li>
<li><code>STAssertNoThrow()</code></li>
<li><code>STAssertNoThrowSpecific()</code></li>
<li><code>STAssertNoThrowSpecificNamed()</code></li>
<li><code>STAssertTrueNoThrow()</code></li>
<li><code>STAssertFalseNoThrow()</code></li>
<li><code>STFail()</code></li>
</ul>

<p>And yet, as useful as tests are, they necessarily introduce friction into a development cycle. When project pressures begin to weigh, tests are the first thing to be thrown overboard. At some point, the tests stop passing ("we can worry about that laterâ€”now we have to ship!")</p>

<p>The only chance testing has to remain relevant in high-pressure situations is to reduce that friction in development. Essentially, tests need to become both <em>easier to write</em> and <em>easier to run</em>.</p>

<h2><a id="user-content-open-source-libraries" class="anchor" href="#open-source-libraries" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Open Source Libraries</h2>

<p>There are a myriad of open source libraries that attempt to make testing more palatable by way of syntactic sugar and features like <a href="https://en.wikipedia.org/wiki/Method_stub">method stubs</a>, <a href="https://en.wikipedia.org/wiki/Mock_object">mock objects</a>, and <a href="http://en.wikipedia.org/wiki/Futures_and_promises">promises</a>.</p>

<p>Here's a list of some of the most useful open source libraries for unit testing:</p>

<table>
  <thead>
    <tr><th colspan="3">Mock Objects</th>
  </tr></thead>
  <tbody>
    <tr>
      <td><a href="https://github.com/erikdoe/ocmock">OCMock</a></td>
      <td><a href="https://github.com/erikdoe">Erik Doernenburg</a></td>
      <td></td>
    </tr>
    <tr>
      <td><a href="https://github.com/jonreid/OCMockito">OCMockito</a></td>
      <td><a href="https://github.com/jonreid">Jon Reid</a></td>
      <td></td>
    </tr>
  </tbody>

  <thead>
    <tr><th colspan="3">Matchers</th>
  </tr></thead>
  <tbody>
    <tr>
      <td><a href="https://github.com/specta/expecta">Expecta</a></td>
      <td><a href="https://github.com/petejkim">Peter Jihoon Kim</a></td>
      <td></td>
    </tr>
    <tr>
      <td><a href="https://github.com/hamcrest/OCHamcrest">OCHamcrest</a></td>
      <td><a href="https://github.com/jonreid">Jon Reid</a></td>
      <td></td>
    </tr>
  </tbody>

  <thead>
    <tr><th colspan="3">BDD / TDD</th>
  </tr></thead>
  <tbody>
    <tr>
      <td><a href="https://github.com/specta/specta">Specta</a></td>
      <td><a href="https://github.com/petejkim">Peter Jihoon Kim</a></td>
      <td></td>
    </tr>
    <tr>
      <td><a href="https://github.com/kiwi-bdd/Kiwi">Kiwi</a></td>
      <td><a href="https://github.com/allending">Allen Ding</a></td>
      <td></td>
    </tr>
    <tr>
      <td><a href="https://github.com/pivotal/cedar">Cedar</a></td>
      <td><a href="https://github.com/pivotal">Pivotal Labs</a></td>
      <td></td>
    </tr>
  </tbody>

  <thead>
    <tr><th colspan="3">Frameworks</th>
  </tr></thead>
  <tbody>
    <tr>
      <td><a href="https://github.com/gh-unit/gh-unit/">GHUnit</a></td>
      <td><a href="https://github.com/gabriel">Gabriel Handford</a></td>
      <td></td>
    </tr>
  </tbody>
</table>

<h2><a id="user-content-automated-testing" class="anchor" href="#automated-testing" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Automated Testing</h2>

<p>Making tests easier to write is one thing, but getting them to run without affecting productivity is quite another.</p>

<h3><a id="user-content-jenkins" class="anchor" href="#jenkins" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Jenkins</h3>

<p>For a long time, installing <a href="http://jenkins-ci.org">Jenkins</a> on a dedicated Mac Mini was the state-of-the-art for automated build servers.</p>

<p>Aside from the fact that it's <em>kinda the worst thing ever to set-up</em>, <a href="https://speakerdeck.com/subdigital/ios-build-automation-with-jenkins">you can do a lot of cool things</a> like notifying build status over IM or IRC, automatically distributing builds to <a href="https://testflightapp.com/dashboard/">TestFlight</a> or <a href="http://hockeyapp.net">HockeyApp</a> with <a href="https://github.com/nomad/shenzhen">Shenzhen</a>, and generating documentation with <a href="http://gentlebytes.com/appledoc/">AppleDoc</a>.</p>

<h3><a id="user-content-travis" class="anchor" href="#travis" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Travis</h3>

<p>Until recently, automated unit testing for Objective-C was the privilege of projects that could dedicate the time and money to setup a CI server. <a href="https://travis-ci.org">Travis CI</a> made CI available to the masses.</p>

<p>CI for Objective-C is more difficult than for other languages, because it needs to be done on a Mac. For economic reasons, there just isn't a market for cloud-based OS X environments like there is for Linux. Fortunately, <a href="https://saucelabs.com">SauceLabs</a> has built such a virtualized Mac cloud, and is graciously donating some of it to run tests for open source Objective-C projects on Travis-CI.</p>

<p>For an example of automated Objective-C unit testing in the wild, check out <a href="https://github.com/afnetworking/afnetworking#unit-tests">how AFNetworking does it</a>.</p>

<p>The <code>Tests</code> subdirectory contains separate projects for iOS and OS X targets, as well as a Podfile, which specifies all of the testing library dependencies. AFNetworking executes a <a href="http://rake.rubyforge.org">Rake</a> task, which shells out to <a href="https://github.com/facebook/xctool"><code>xctool</code></a>.</p>

<p>All of the configuration for setup is defined in <code>.travis.yml</code>:</p>

<h4><a id="user-content-travisyml" class="anchor" href="#travisyml" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>.travis.yml</h4>

<pre><code>language: objective-c
before_install:
  - brew update
  - brew install xctool --HEAD
  - cd Tests &amp;&amp; pod install &amp;&amp; cd $TRAVIS_BUILD_DIR
  - mkdir -p "Tests/AFNetworking Tests.xcodeproj/xcshareddata/xcschemes" &amp;&amp; cp Tests/Schemes/*.xcscheme "Tests/AFNetworking Tests.xcodeproj/xcshareddata/xcschemes/"
script: rake test
</code></pre>

<p>Full documentation for the Travis configuration file <a href="http://about.travis-ci.org/docs/user/build-configuration/">can be found on Travis-CI.org</a>.</p>

<hr>

<p>Once again, the direction of Objective-C has been directly influenced by the Ruby community. Those guys and gals are <em>serious</em> about testing. It's not like we should complain, though: between <a href="http://cocoapods.org">CocoaPods</a>, <a href="http://www.rubymotion.com">RubyMotion</a>, and <a href="http://nomad-cli.com">Nomad</a>, Ruby has made Objective-C development better by several orders of magnitude.</p>

<p>The bottom line is that testing has come to Objective-C. It's not always necessary, and it's certainly not a silver bullet for writing great software, but it's proven itself invaluable (especially for open source development). So give it a try now, before <em>not</em> testing becomes <em>seriously uncool</em>.</p>
</article></div>