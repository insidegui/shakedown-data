<div class="announce instapaper_body md" data-path="2013-07-08-nsexpression.md" id="file"><article class="markdown-body entry-content" itemprop="text"><table data-table-type="yaml-metadata">
  <thead>
  <tr>
  <th>title</th>

  <th>author</th>

  <th>category</th>

  <th>tags</th>

  <th>excerpt</th>

  <th>status</th>
  </tr>
  </thead>
  <tbody>
  <tr>
  <td><div>NSExpression</div></td>

  <td><div>Mattt Thompson</div></td>

  <td><div>Cocoa</div></td>

  <td><div>nshipster</div></td>

  <td><div>Cocoa is the envy of other standard libraries when it comes to querying and arranging information. With NSPredicate, NSSortDescriptor, and an occasional NSFetchRequest, even the most complex data tasks can be reduced into just a few, extremely-understandable lines of code.</div></td>

  <td><div><table>
  <thead>
  <tr>
  <th>swift</th>

  <th>reviewed</th>
  </tr>
  </thead>
  <tbody>
  <tr>
  <td><div>2.0</div></td>

  <td><div>September 8, 2015</div></td>
  </tr>
  </tbody>
</table></div></td>
  </tr>
  </tbody>
</table>

<p>Cocoa is the envy of other standard libraries when it comes to querying and arranging information. With <code>NSPredicate</code>, <a href="http://nshipster.com/nssortdescriptor/"><code>NSSortDescriptor</code></a>, and an occasional <code>NSFetchRequest</code>, even the most complex data tasks can be reduced into just a few, <em>extremely-understandable</em> lines of code.</p>

<p>Now, NSHipsters are no doubt already familiar with <code>NSPredicate</code> (and if you aren't, be sure to tune in next week!), but if we take a closer look at <code>NSPredicate</code>, we see that <code>NSPredicate</code> is actually made up of smaller, atomic parts: two <code>NSExpression</code>s (a left-hand value &amp; a right-hand value), compared with an operator (e.g. <code>&lt;</code>, <code>IN</code>, <code>LIKE</code>, etc.).</p>

<p>Because most developers only use <code>NSPredicate</code> by means of <code>+predicateWithFormat:</code>, <code>NSExpression</code> is a relatively obscure class. Which is a shame, because <code>NSExpression</code> is quite an incredible piece of functionality in its own right.</p>

<p>So allow me, dear readers, to express my respect and fascination with <code>NSExpression</code>:</p>

<h2><a id="user-content-evaluating-math" class="anchor" href="#evaluating-math" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Evaluating Math</h2>

<p>The first thing you should know about <code>NSExpression</code> is that it lives to reduce terms. If you think about the process of evaluating an <code>NSPredicate</code>, there are two terms and a comparator, so those two terms need to simplify into something that the operator can handle—very much like the process of compiling a line of code.</p>

<p>Which leads us to <code>NSExpression</code>'s first trick: <strong>doing math</strong>.</p>

<div class="highlight highlight-source-swift"><pre><span class="pl-k">let</span> mathExpression <span class="pl-k">=</span> NSExpression(format: <span class="pl-s"><span class="pl-pds">"</span>4 + 5 - 2**3<span class="pl-pds">"</span></span>)
<span class="pl-k">let</span> mathValue <span class="pl-k">=</span> mathExpression<span class="pl-k">.</span>expressionValueWithObject(<span class="pl-c1">nil</span>, context: <span class="pl-c1">nil</span>) <span class="pl-k">as?</span> <span class="pl-c1">Int</span> 
<span class="pl-c">// 1</span></pre></div>

<div class="highlight highlight-source-objc"><pre><span class="pl-c1">NSExpression</span> *expression = [<span class="pl-c1">NSExpression</span> <span class="pl-c1">expressionWithFormat:</span><span class="pl-s"><span class="pl-pds">@"</span>4 + 5 - 2**3<span class="pl-pds">"</span></span>];
<span class="pl-c1">id</span> value = [expression <span class="pl-c1">expressionValueWithObject:</span><span class="pl-c1">nil</span> <span class="pl-c1">context:</span><span class="pl-c1">nil</span>]; <span class="pl-c">// =&gt; 1</span></pre></div>

<p>It's no <a href="http://www.wolframalpha.com/input/?i=finn+the+human+like+curve">Wolfram Alpha</a>, but if your app does anything where evaluating mathematical expressions would be useful, well... there you go.</p>

<h2><a id="user-content-functions" class="anchor" href="#functions" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Functions</h2>

<p>But we've only just scratched the surface with <code>NSExpression</code>. Not impressed by a computer doing primary-school maths? How about high school statistics, then?</p>

<div class="highlight highlight-source-swift"><pre><span class="pl-k">let</span> numbers <span class="pl-k">=</span> [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">4</span>, <span class="pl-c1">4</span>, <span class="pl-c1">5</span>, <span class="pl-c1">9</span>, <span class="pl-c1">11</span>]
<span class="pl-k">let</span> statsExpression <span class="pl-k">=</span> NSExpression(forFunction:<span class="pl-s"><span class="pl-pds">"</span>stddev:<span class="pl-pds">"</span></span>, arguments:[NSExpression(forConstantValue: numbers)])
<span class="pl-k">let</span> statsValue <span class="pl-k">=</span> statsExpression<span class="pl-k">.</span>expressionValueWithObject(<span class="pl-c1">nil</span>, context: <span class="pl-c1">nil</span>) <span class="pl-k">as?</span> <span class="pl-c1">Double</span>
<span class="pl-c">// 3.21859...</span></pre></div>

<div class="highlight highlight-source-objc"><pre><span class="pl-c1">NSArray</span> *numbers = @[@<span class="pl-c1">1</span>, @<span class="pl-c1">2</span>, @<span class="pl-c1">3</span>, @<span class="pl-c1">4</span>, @<span class="pl-c1">4</span>, @<span class="pl-c1">5</span>, @<span class="pl-c1">9</span>, @<span class="pl-c1">11</span>];
<span class="pl-c1">NSExpression</span> *expression = [<span class="pl-c1">NSExpression</span> <span class="pl-c1">expressionForFunction:</span><span class="pl-s"><span class="pl-pds">@"</span>stddev:<span class="pl-pds">"</span></span> <span class="pl-c1">arguments:</span>@[[<span class="pl-c1">NSExpression</span> <span class="pl-c1">expressionForConstantValue:</span>numbers]]];
<span class="pl-c1">id</span> value = [expression <span class="pl-c1">expressionValueWithObject:</span><span class="pl-c1">nil</span> <span class="pl-c1">context:</span><span class="pl-c1">nil</span>]; <span class="pl-c">// =&gt; 3.21859...</span></pre></div>

<blockquote>
<p><code>NSExpression</code> functions take a given number of sub-expression arguments. For instance, in the above example, to get the standard deviation of the collection, the array of numbers had to be wrapped with <code>+expressionForConstantValue:</code>. A minor inconvenience (which ultimately allows <code>NSExpression</code> to be incredibly flexible), but enough to trip up anyone trying things out for the first time.</p>
</blockquote>

<p>If you found the <a href="http://nshipster.com/kvc-collection-operators/">Key-Value Coding Simple Collection Operators</a> (<code>@avg</code>, <code>@sum</code>, et al.) lacking, perhaps <code>NSExpression</code>'s built-in statistical, arithmetic, and bitwise functions will pique your interest.</p>

<blockquote>
<p><strong>A word of caution</strong>: <a href="http://developer.apple.com/library/ios/#documentation/cocoa/reference/foundation/Classes/NSExpression_Class/Reference/NSExpression.html">according to this table in Apple's documentation for <code>NSExpression</code></a>, there is apparently no overlap between the availability of functions between OS X &amp; iOS. It would appear that recent versions of iOS do, indeed, support functions like <code>stddev:</code>, but this is not reflected in headers or documentation. Any details <a href="https://github.com/NSHipster/articles/pulls">in the form of a pull request</a> would be greatly appreciated.</p>
</blockquote>

<h3><a id="user-content-statistics" class="anchor" href="#statistics" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Statistics</h3>

<ul>
<li><code>average:</code></li>
<li><code>sum:</code></li>
<li><code>count:</code></li>
<li><code>min:</code></li>
<li><code>max:</code></li>
<li><code>median:</code></li>
<li><code>mode:</code></li>
<li><code>stddev:</code></li>
</ul>

<h3><a id="user-content-basic-arithmetic" class="anchor" href="#basic-arithmetic" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Basic Arithmetic</h3>

<p>These functions take two <code>NSExpression</code> objects representing numbers.</p>

<ul>
<li><code>add:to:</code></li>
<li><code>from:subtract:</code></li>
<li><code>multiply:by:</code></li>
<li><code>divide:by:</code></li>
<li><code>modulus:by:</code></li>
<li><code>abs:</code></li>
</ul>

<h3><a id="user-content-advanced-arithmetic" class="anchor" href="#advanced-arithmetic" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Advanced Arithmetic</h3>

<ul>
<li><code>sqrt:</code></li>
<li><code>log:</code></li>
<li><code>ln:</code></li>
<li><code>raise:toPower:</code></li>
<li><code>exp:</code></li>
</ul>

<h3><a id="user-content-bounding-functions" class="anchor" href="#bounding-functions" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bounding Functions</h3>

<ul>
<li><code>ceiling:</code> - <em>(the smallest integral value not less than the value in the array)</em></li>
<li><code>trunc:</code> - <em>(the integral value nearest to but no greater than the value in the array)</em></li>
</ul>

<h3><a id="user-content-functions-shadowing-mathh-functions" class="anchor" href="#functions-shadowing-mathh-functions" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Functions Shadowing <code>math.h</code> Functions</h3>

<p>So mentioned, because <code>ceiling</code> is easily confused with <code>ceil(3)</code>. Whereas <code>ceiling</code> acts on an array of numbers, while <code>ceil(3)</code> takes a <code>double</code> (and doesn't have a corresponding built-in <code>NSExpression</code> function). <code>floor:</code> here acts the same as <code>floor(3)</code>.</p>

<ul>
<li><code>floor:</code></li>
</ul>

<h3><a id="user-content-random-functions" class="anchor" href="#random-functions" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Random Functions</h3>

<p>Two variations—one with and one without an argument. Taking no argument, <code>random</code> returns an equivalent of <code>rand()</code>, while <code>randomn:</code> takes a single number and returns an equivalent of <code>rand(3)</code>.</p>

<ul>
<li><code>random</code></li>
<li><code>randomn:</code></li>
</ul>

<h3><a id="user-content-binary-arithmetic" class="anchor" href="#binary-arithmetic" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Binary Arithmetic</h3>

<ul>
<li><code>bitwiseAnd:with:</code></li>
<li><code>bitwiseOr:with:</code></li>
<li><code>bitwiseXor:with:</code></li>
<li><code>leftshift:by:</code></li>
<li><code>rightshift:by:</code></li>
<li><code>onesComplement:</code></li>
</ul>

<h3><a id="user-content-date-functions" class="anchor" href="#date-functions" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Date Functions</h3>

<ul>
<li><code>now</code></li>
</ul>

<h3><a id="user-content-string-functions" class="anchor" href="#string-functions" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>String Functions</h3>

<ul>
<li><code>lowercase:</code></li>
<li><code>uppercase:</code></li>
</ul>

<h3><a id="user-content-no-op" class="anchor" href="#no-op" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>No-op</h3>

<ul>
<li><code>noindex:</code></li>
</ul>

<h2><a id="user-content-custom-functions" class="anchor" href="#custom-functions" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Custom Functions</h2>

<p>In addition to these built-in functions, it's possible to invoke custom functions in an <code>NSExpression</code>. <a href="http://funwithobjc.tumblr.com/post/2922267976/using-custom-functions-with-nsexpression">This article by Dave DeLong</a> describes the process.</p>

<p>First, define the corresponding method in a category:</p>

<div class="highlight highlight-source-swift"><pre><span class="pl-k">extension</span> NSNumber {
    <span class="pl-k">func</span> <span class="pl-en">factorial</span>() <span class="pl-k">-&gt;</span> NSNumber {
        <span class="pl-k">return</span> tgamma(<span class="pl-k">self</span><span class="pl-k">.</span>doubleValue <span class="pl-k">+</span> <span class="pl-c1">1</span>)
    }
}</pre></div>

<div class="highlight highlight-source-objc"><pre><span class="pl-k">@interface</span> <span class="pl-en">NSNumber</span> (Factorial)
- (<span class="pl-c1">NSNumber</span> *)<span class="pl-en">factorial</span>;
<span class="pl-k">@end</span>

<span class="pl-k">@implementation</span> <span class="pl-en">NSNumber</span> (Factorial)
- (<span class="pl-c1">NSNumber</span> *)<span class="pl-en">factorial</span> {
    <span class="pl-k">return</span> @(<span class="pl-c1">tgamma</span>([<span class="pl-v">self</span> <span class="pl-c1">doubleValue</span>] + <span class="pl-c1">1</span>));
}
<span class="pl-k">@end</span></pre></div>

<p>Then, use the function thusly (the <code>FUNCTION()</code> macro in <code>+expressionWithFormat:</code> is shorthand for the process of building out with <code>-expressionForFunction:</code>, et al.):</p>

<div class="highlight highlight-source-swift"><pre><span class="pl-k">let</span> functionExpression <span class="pl-k">=</span> NSExpression(format:<span class="pl-s"><span class="pl-pds">"</span>FUNCTION(4.2, 'factorial')<span class="pl-pds">"</span></span>)
<span class="pl-k">let</span> functionValue <span class="pl-k">=</span> functionExpression<span class="pl-k">.</span>expressionValueWithObject(<span class="pl-c1">nil</span>, context: <span class="pl-c1">nil</span>) <span class="pl-k">as?</span> <span class="pl-c1">Double</span>
<span class="pl-c">// 32.578...</span></pre></div>

<div class="highlight highlight-source-objc"><pre><span class="pl-c1">NSExpression</span> *expression = [<span class="pl-c1">NSExpression</span> <span class="pl-c1">expressionWithFormat:</span><span class="pl-s"><span class="pl-pds">@"</span>FUNCTION(4.2, 'factorial')<span class="pl-pds">"</span></span>];
<span class="pl-c1">id</span> value = [expression <span class="pl-c1">expressionValueWithObject:</span><span class="pl-c1">nil</span> <span class="pl-c1">context:</span><span class="pl-c1">nil</span>]; <span class="pl-c">// 32.578...</span></pre></div>

<p>The advantage here, over calling <code>-factorial</code> directly is the ability to invoke the function in an <code>NSPredicate</code> query. For example, a <code>location:withinRadius:</code> method might be defined to easily query managed objects nearby a user's current location.</p>

<p>As Dave mentions in his article, the use cases are rather marginal, but it's certainly an interesting trick to have in your repertoire.</p>

<hr>

<p>Next week, we'll build on what we just learned about <code>NSExpression</code> to further explore <code>NSPredicate</code>, and everything it has hidden up its sleeves. Stay tuned!</p>
</article></div>